setwd('~/Desktop/YahtzeeData/')
list.files(unzip('results/65.zip'))
sc <- readLines('65/rawText.txt')
?readLines
sc
sc[1:(which(sc == 'LOWER SECTION'))]
sc[1:(which(sc == 'LOWER SECTION') - 1L)]
x <_ sc[1:(which(sc == 'LOWER SECTION') - 1)]
us <- sc[1:(which(sc == 'LOWER SECTION') - 1)]
us
us[!us %in% c('Count and add', 'only Aces')]
readLines('65/rawText.txt')
sc <- readLines('65/rawText.txt')
sc <- sc[-1]
us <- sc[1:(which(sc == 'LOWER SECTION') - 1)]
us[!us %in% c('Count and add', 'only Aces')]
us <- us[!us %in% c('Count and add', 'only Aces')]
us
us <- sc[1:(which(sc == 'LOWER SECTION') - 1)]
us[!us %in% c('Count and add', 'only Aces', '.', ':', '::')]
us <- us[!us %in% c('Count and add', 'only Aces', '.', ':', '::')]
us[!us %in% c('Count and add', 'only Aces', 'only Twos', 'only Threes', 'only Fours', 'only Fives', 'only Sixes',
'.', ':', '::',
'Aces', 'Twos', 'Threes', 'Fours', 'Fives', 'Sixes',
'TOTAL', 'BONUS', 'If total score', 'is 63 or over', 'SCORE 35', 'Of Upper', 'Section')]
read.csv('65/table-1.csv')
read.csv('65/table-1.csv', quote='"')
?read.csv
read.csv('65/table-1.csv', header=FALSE, quote='"')
readLines('65/table-1.csv'
)
t1 <- readLines('65/table-1.csv')
t1[1:(grep(',,,+', t1) - 1)]
t1 <- t1[1:(grep(',,,+', t1) - 1)]
t1
gsub('"\,', '', t1)
gsub('",', '', t1)
gsub('\\",', '', t1)
t1[1]
gsub('\\",', '', t1[1])
gsub('\\\",', '', t1[1])
t1
strsplit(t1[1], split=)
strsplit(t1[1], split='\",\"')
t1[1]
gsub("'", '', t1[1])
t1 <- gsub("'", '', t1)
t1
gsub('"', '', t1)
t1 <- gsub('"', '', t1)
t1
t1 <- gsub(',', '', t1)
t1
t1 <- readLines('65/table-1.csv')
t1 <- t1[1:(grep(',,,+', t1) - 1)]
t1 <- gsub("'", '', t1)
t1 <- gsub('"', '', t1)
t1 <- strsplit(t1, ',')
t1
sapply(X = t1[1:6],
FUN = function(x) {
return(x[4:length(x)])
})
lapply(X = t1[1:6],
FUN = function(x) {
return(x[4:length(x)])
})
lapply(X = t1[1:6],
FUN = function(x) {
x <- x[4:length(x)]
x <- gsub('I', '1', x)
x <- gsub('S', '5', x)
return(x)
})
lapply(X = t1[1:6],
FUN = function(x) {
x <- x[4:length(x)]
x <- gsub('I', '1', x)
x <- gsub('S', '5', x)
return(as.integer(x))
})
sapply(X = t1[1:6],
FUN = function(x) {
x <- x[4:length(x)]
x <- gsub('I', '1', x)
x <- gsub('S', '5', x)
return(as.integer(x))
})
t(sapply(X = t1[1:6],
FUN = function(x) {
x <- x[4:length(x)]
x <- gsub('I', '1', x)
x <- gsub('S', '5', x)
return(as.integer(x))
}))
t1[7:9]
t1[[7]][4:9]
as.integer(t1[[7]][4:9])
t1[[8]]
t1[[8]][4:9]
as.integer(t1[[8]][4:9])
as.integer(t1[[9]][4:9])
t(sapply(X = t1,
FUN = function(x) {
x <- x[4:length(x)]
x <- gsub('I', '1', x)
x <- gsub('S', '5', x)
x <- as.integer(x)
return(x)
}))
t1 <- t(sapply(X = t1,
FUN = function(x) {
x <- x[4:length(x)]
x <- gsub('I', '1', x)
x <- gsub('S', '5', x)
x <- as.integer(x)
return(x)
}))
1
t1
rownames(t) <- c('Aces', 'Twos', 'Threes', 'Fours', 'Fives', 'Sixes', 'Total1', 'Bonus', 'Total2')
rownames(t1) <- c('Aces', 'Twos', 'Threes', 'Fours', 'Fives', 'Sixes', 'Total1', 'Bonus', 'Total2')
t1
colnames(t2) <- c('Julia1', 'Sam1', 'Julia2', 'Sam2', 'Julia3', 'Sam3')
colnames(t1) <- c('Julia1', 'Sam1', 'Julia2', 'Sam2', 'Julia3', 'Sam3')
t1
t1[1:6,]
apply(t1[1:6,], 2, sum)
apply(t1[1:6,], 2, sum) == t1[7,]
all(apply(t1[1:6,], 2, sum) == t1[7,])
t1[7,] + t1[8,]
all((t1[7,] + t1[8,]) == t1[9,])
t2 <- readLines('65/table-2.csv')
t2
t2[1:(grep(',,,+', t2) - 1)]
t2 <- t2[1:(grep(',,,+', t2) - 1)]
gsub("'", '', t2)
t2 <- gsub("'", '', t2)
gsub('"', '', t2)
t2 <- readLines('65/table-2.csv')
t2 <- t2[1:(grep(',,,+', t2))]
t2 <- gsub("'", '', t2)
t2 <- gsub('"', '', t2)
t
t2
t2 <- readLines('65/table-2.csv')
t2 <- t2[1:(grep('LOWER SECTION', t2))]
t2
t2
t2 <- readLines('65/table-2.csv')
t2
t2 <- t2[2:(grep(',,,,+', t2))]
t2
t2 <- readLines('65/table-2.csv')
t2 <- t2[2:(grep(',,,,+', t2) - 1)]
t2 <- gsub("'", '', t2)
t2 <- gsub('"', '', t2)
t2
t2 <- strsplit(t2, ',')
t2
sapply(X = t2[c(1:7, 10:12)],
FUN = function(x) {
x <- x[4:length(x)]
x <- gsub('I', '1', x)
x <- gsub('S', '5', x)
x <- as.integer(x)
return(x)
})
sapply(X = t2[c(1:7, 10:12)],
FUN = function(x) {
x <- x[3:length(x)]
x <- gsub('I', '1', x)
x <- gsub('S', '5', x)
x <- as.integer(x)
return(x)
})
t(sapply(X = t2[c(1:7, 10:12)],
FUN = function(x) {
x <- x[3:length(x)]
x <- gsub('I', '1', x)
x <- gsub('S', '5', x)
x <- as.integer(x)
return(x)
}))
t(sapply(X = t2[c(1:7, 10:12)],
FUN = function(x) {
x <- x[3:length(x)]
x <- gsub('I', '1', x)
x <- gsub('S', '5', x)
x <- as.integer(x)
x[is.na(x)] <- 0L
return(x)
}))
parseNums <- function(x) {
x <- x[3:length(x)]
x <- gsub('I', '1', x)
x <- gsub('S', '5', x)
x <- as.integer(x)
x[is.na(x)] <- 0L
return(x)
}
t1 <- readLines('65/table-1.csv')
t1 <- t1[1:(grep(',,,+', t1) - 1)]
t1 <- gsub("'", '', t1)
t1 <- gsub('"', '', t1)
t1 <- strsplit(t1, ',')
t1
t(sapply(X = t1,
FUN = parseNums))
parseNums <- function(x, table=1) {
w <- 4
if (table == 2) w <- 3
x <- x[w:length(x)]
x <- gsub('I', '1', x)
x <- gsub('S', '5', x)
x <- as.integer(x)
x[is.na(x)] <- 0L
return(x)
}
t(sapply(X = t1,
FUN = parseNums))
t1 <- readLines('65/table-1.csv')
t1 <- t1[1:(grep(',,,+', t1) - 1)]
t1 <- gsub("'", '', t1)
t1 <- gsub('"', '', t1)
t1 <- strsplit(t1, ',')
t1 <- t(sapply(X = t1,
FUN = parseNums))
rownames(t1) <- c('Aces', 'Twos', 'Threes', 'Fours', 'Fives', 'Sixes', 'Total1', 'Bonus', 'Total2')
colnames(t1) <- c('Julia1', 'Sam1', 'Julia2', 'Sam2', 'Julia3', 'Sam3')
t1
t2 <- readLines('65/table-2.csv')
t2 <- t2[2:(grep(',,,,+', t2) - 1)]
t2 <- gsub("'", '', t2)
t2 <- gsub('"', '', t2)
t2 <- strsplit(t2, ',')
t1
t2
t(sapply(X = t2[c(1:7, 10:12)],
FUN = parseNums, table=2))
dir <- '65'
table <- 1
paste0(dir, '/table-', table, '.csv')
readLines(paste0(dir, '/table-', table, '.csv'))
t <- readLines(paste0(dir, '/table-', table, '.csv'))
start_line <- 1
if (table == 2) start_line <- 2
t <- t[start_line:(grep(',,+', t) - 1)]
t
table
table <- 2
t <- readLines(paste0(dir, '/table-', table, '.csv'))
start_line <- 1
if (table == 2) start_line <- 2
t <- t[start_line:(grep(',,+', t) - 1)]
t
col_names <- c('Julia1', 'Sam1', 'Julia2', 'Sam2', 'Julia3', 'Sam3')
t1
t2
sapply(X = t2[c(1:7, 10:12)], parseNums, table=2)
table
t
t <- gsub("'", '', t)
t <- gsub('"', '', t)
t
if (table == 2)
t <- t[c(1:7, 10:12)]
t
t <- strsplit(t, ',')
sapply(t, parseNums, table=table)
t <- sapply(t, parseNums, table=table)
t <- t(t)
t
paste0(3:4, ' of a Kind')
prepLines <- function(table=1, dir) {
t <- readLines(paste0(dir, '/table-', table, '.csv'))
start_line <- 1
if (table == 2) start_line <- 2
t <- t[start_line:(grep(',,+', t) - 1)]
t <- gsub("'", '', t)
t <- gsub('"', '', t)
if (table == 2)
t <- t[c(1:7, 10:12)]
t <- strsplit(t, ',')
t <- sapply(t, parseNums, table=table)
t <- t(t)
if (table == 1) {
row_names <- c('Aces', 'Twos', 'Threes', 'Fours', 'Fives', 'Sixes', 'Total1', 'Bonus', 'Total2')
} else if (table == 2) {
row_names <- c(paste0(3:4, ' of a Kind'), 'Full House', 'SM Straight', 'LG Straight', 'Yahtzee', 'Chance', 'TotalLower', 'TotalUpper', 'GrandTotal')
}
rownames(t) <- row_names
colnames(t) <- col_names
return(t)
}
prepLines(table=1, dir='65')
prepLines(table=2, dir='65')
combineTables <- function(dir) {
rbind(
prepLines(table=1, dir=dir),
prepLines(table=2, dir=dir)
)
}
combineTables('65')
t
t <- rbind(
prepLines(table=1, dir=dir),
prepLines(table=2, dir=dir)
)
t
apply(t[1:6,], 2, sum)
apply(t[1:6,], 2, sum) == t[7,]
all((t[7,] + t[8,]) == t[9,])
t1
t
setwd('~/Desktop/YahtzeeData/')
parseNums <- function(x, table=1) {
w <- 4
if (table == 2) w <- 3
x <- x[w:length(x)]
x <- gsub('I', '1', x)
x <- gsub('S', '5', x)
x <- as.integer(x)
x[is.na(x)] <- 0L
return(x)
}
prepLines <- function(table=1, dir) {
t <- readLines(paste0(dir, '/table-', table, '.csv'))
start_line <- 1
if (table == 2) start_line <- 2
t <- t[start_line:(grep(',,+', t) - 1)]
t <- gsub("'", '', t)
t <- gsub('"', '', t)
if (table == 2)
t <- t[c(1:7, 10:12)]
t <- strsplit(t, ',')
t <- sapply(t, parseNums, table=table)
t <- t(t)
if (table == 1) {
row_names <- c('Aces', 'Twos', 'Threes', 'Fours', 'Fives', 'Sixes', 'Total1', 'Bonus', 'Total2')
} else if (table == 2) {
row_names <- c(paste0(3:4, ' of a Kind'), 'Full House', 'SM Straight', 'LG Straight', 'Yahtzee', 'Chance', 'TotalLower', 'TotalUpper', 'GrandTotal')
}
rownames(t) <- row_names
colnames(t) <- c('Julia1', 'Sam1', 'Julia2', 'Sam2', 'Julia3', 'Sam3')
return(t)
}
combineTables <- function(dir) {
t <- rbind(
prepLines(table=1, dir=dir),
prepLines(table=2, dir=dir)
)
if (!all(apply(t[1:6,], 2, sum) == t[7,])) {
cat('Upper section - bad math / OCR - part 1')
break
}
if (!all((t[7,] + t[8,]) == t[9,])) {
cat('Upper section - bad math / OCR - part 2')
break
}
}
dir <-
'65'
t <- rbind(
prepLines(table=1, dir=dir),
prepLines(table=2, dir=dir)
)
t
apply(t[1:6,], 2, sum) == t[7,]
t[7,] + t[8,]) == t[9,])
(t[7,] + t[8,]) == t[9,])
(t[7,] + t[8,]) == t[9,]
t
t[10:16,]
apply(t[10:16,], 2, sum) == t['TotalLower',]
t['Total2',]
t['TotalUpper',]
t['Total2',] == t['TotalUpper',]
t
t['TotalLower',] + t['TotalUpper',]
(t['TotalLower',] + t['TotalUpper',]) == t[]
(t['TotalLower',] + t['TotalUpper',]) == t['GrandTotal',]
combineTables <- function(dir) {
t <- rbind(
prepLines(table=1, dir=dir),
prepLines(table=2, dir=dir)
)
# verify math + OCR
if (!all(apply(t[1:6,], 2, sum) == t['Total1',])) {
cat('Upper section - bad math / OCR - part 1')
break
}
if (!all((t['Total1',] + t['Bonus',]) == t['Total2',])) {
cat('Upper section - bad math / OCR - part 2')
break
}
if (!all(apply(t[10:16,], 2, sum) == t['TotalLower',])) {
cat('Lower section - bad math / OCR - part 1')
break
}
if (!all(t['Total2',] == t['TotalUpper',])) {
cat('Lower total != top and bottom')
break
}
if (!all((t['TotalLower',] + t['TotalUpper',]) == t['GrandTotal',])) {
cat('Grand total math != Grand total stated')
break
}
return(t)
}
t('65')
combineTables(65)
